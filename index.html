<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تحقق من توافق سيرتك الذاتية مع ATS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      min-height: 100vh;
    }
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background: linear-gradient(120deg, #74ebd5 0%, #ACB6E5 100%);
      display: flex;
      flex-direction: column;
      font-family: 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
    }

    .navbar {
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      background: #fff;
      padding: 10px 0;
      box-shadow: 0 2px 16px rgba(44, 62, 80, 0.05);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
      transition: box-shadow 0.3s;
    }
    .navbar img {
      height: 38px;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 1px 6px rgba(180, 180, 180, 0.09);
      padding: 4px 12px;
    }

    .container {
      flex: 1 0 auto;
      background: #fff;
      border-radius: 28px;
      box-shadow: 0 10px 40px rgba(52, 152, 219, 0.09);
      padding: 44px 28px 36px 28px;
      width: 98%;
      max-width: 530px;
      margin-top: 60px;
      margin-bottom: 40px;
      animation: slideUp 0.7s cubic-bezier(.77,.01,.29,.99);
      position: relative;
      align-self: center;
    }

    h2 {
      color: #227093;
      font-size: 28px;
      margin-bottom: 32px;
      text-align: center;
      font-weight: 800;
      letter-spacing: 1px;
      word-spacing: 2px;
    }

    /* Drag & Drop Area Styles */
    .drop-area {
      border: 2px dashed #d3dbe5;
      border-radius: 18px;
      background: #fafbfc;
      min-height: 200px;
      margin: 0 auto 16px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: border-color 0.3s, background 0.3s;
      position: relative;
      overflow: hidden;
    }
    .drop-area.dragover {
      border-color: #38ada9;
      background: #f1fafa;
    }
    .icon-wrapper {
      margin-top: 18px;
      margin-bottom: 8px;
      transition: opacity 0.3s;
    }
    .icon-wrapper.hide {
      opacity: 0;
      pointer-events: none;
      height: 0;
      margin: 0;
    }
    .drop-text {
      color: #bbc4ce;
      font-size: 17px;
      margin-bottom: 8px;
      margin-top: 7px;
      font-weight: 600;
      user-select: none;
      transition: opacity 0.3s;
    }
    .drop-text.hide {
      opacity: 0;
      pointer-events: none;
      height: 0;
      margin: 0;
    }
    .choose-btn {
      background: #fff;
      color: #227093;
      border: 1.5px solid #d3dbe5;
      border-radius: 7px;
      padding: 8px 28px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 18px;
      transition: background 0.2s, border 0.2s, opacity 0.3s;
      box-shadow: 0 2px 6px rgba(52,152,219,0.04);
      display: inline-block;
      text-align: center;
    }
    .choose-btn.hide {
      opacity: 0;
      pointer-events: none;
      height: 0;
      margin: 0;
    }
    .filename {
      margin-top: 0px;
      font-size: 18px;
      color: #fff;
      background: #555;
      border-radius: 30px;
      padding: 32px 48px;
      text-align: center;
      word-break: break-all;
      min-height: 24px;
      margin-bottom: 6px;
      font-family: inherit;
      display: none;
      align-items: center;
      justify-content: center;
    }
    .filename.active {
      display: flex;
      animation: fadeIn 0.6s;
    }

    input[type="file"] {
      display: none;
    }

    textarea {
      width: 100%;
      padding: 12px;
      font-size: 15px;
      margin-top: 18px;
      border-radius: 12px;
      border: 1.5px solid #d0e6f6;
      box-sizing: border-box;
      background: #f6fbff;
      resize: vertical;
      min-height: 48px;
      outline: none;
      transition: border 0.25s;
    }
    textarea:focus {
      border: 1.5px solid #227093;
      background: #e5f0fb;
    }

    .analyze-btn {
      display: block;
      margin: 24px auto 0;
      padding: 11px 30px;
      font-size: 15px;
      background: linear-gradient(90deg, #38ada9 0%, #227093 100%);
      color: #fff;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      box-shadow: 0 2px 10px rgba(44, 62, 80, 0.06);
      letter-spacing: 0.8px;
      transition: background 0.3s, transform 0.2s;
    }
    .analyze-btn:hover {
      background: linear-gradient(90deg, #227093 0%, #38ada9 100%);
      transform: scale(1.04);
    }

    #score {
      font-size: 23px;
      color: #1abc9c;
      font-weight: 700;
      margin-top: 26px;
      text-align: center;
      letter-spacing: 0.5px;
    }

    #progress {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0 8px 0;
    }
    #progressBar {
      width: 100%;
      height: 13px;
      border-radius: 8px;
      background: #e3f6ff;
      box-shadow: 0 1px 4px rgba(44, 62, 80, 0.04);
      accent-color: #38ada9;
    }

    .section {
      margin: 20px 0 0 0;
      padding: 0 4px;
    }

    .found {
      color: #30b04a;
      font-weight: 600;
      font-size: 15px;
    }
    .missing {
      color: #e74c3c;
      font-weight: 600;
      font-size: 15px;
    }
    ul {
      padding-right: 22px;
      margin: 0;
    }
    li {
      margin-bottom: 7px;
      line-height: 1.7;
      font-size: 15px;
    }

    #fonts, #notes, #suggestions, #tables-images, #sections {
      font-size: 15px;
      background: #f8fafd;
      border-radius: 10px;
      padding: 12px 15px;
      margin-top: 10px;
      box-shadow: 0 1px 8px rgba(44, 62, 80, 0.02);
      border: 1px solid #e4ecf4;
    }

    #fonts strong, #notes strong, #suggestions strong, #tables-images strong, #sections strong {
      color: #227093;
      font-size: 15.5px;
      font-weight: 700;
    }

    #match {
      font-size: 17px;
      color: #227093;
      font-weight: 600;
      letter-spacing: 0.6px;
      margin-top: 18px;
    }

    footer {
      flex-shrink: 0;
      width: 100%;
      text-align: center;
      padding: 16px 0 10px 0;
      font-size: 15px;
      color: #227093;
      background: transparent;
      font-weight: 600;
      animation: fadeIn 1.5s ease-in;
      letter-spacing: 1px;
      margin-top: auto;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px);}
      to { opacity: 1; transform: translateY(0);}
    }

    @media (max-width: 600px) {
      .container { max-width: 99%; padding: 18px 3vw 18px 3vw; }
      h2 { font-size: 21px; }
      .navbar img { height: 28px; }
      .drop-area { min-height: 120px; }
      .icon-wrapper { margin-top: 8px; }
      .choose-btn { font-size: 15px; min-width: 85px; padding: 7px 8px;}
      textarea { font-size: 13px; }
      .filename.active { padding: 18px 12px; font-size: 15px;}
    }
  </style>
</head>
<body>
  <div class="navbar">
    <img src="logo.png" alt="Logo">
  </div>
  <div class="container">
    <h2>تحقق من توافق سيرتك الذاتية مع نظام ATS</h2>
    <form id="uploadForm">
      <div class="drop-area" id="drop-area">
        <div class="icon-wrapper" id="iconWrapper">
          <svg width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="28" cy="28" r="27" stroke="#ddd" stroke-width="2"/>
            <path d="M28 38V18" stroke="#bbb" stroke-width="2.5" stroke-linecap="round"/>
            <path d="M22 24l6-6 6 6" stroke="#bbb" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="drop-text" id="dropText">اسحب الملف هنا أو</div>
        <label class="choose-btn" id="chooseBtn">
          اختيار ملف
          <input type="file" id="resumeFile" accept=".pdf,.doc,.docx,.rtf,.txt" hidden>
        </label>
        <div class="filename" id="fileName"></div>
      </div>
      <textarea id="jobDescription" rows="4" placeholder="ألصق وصف الوظيفة هنا للمقارنة... (اختياري)"></textarea>
      <button class="analyze-btn" type="submit">تحليل</button>
    </form>
    <div id="score"></div>
    <div id="progress" style="display:none;margin:12px 0;">
      <progress id="progressBar" value="0" max="100" style="width:100%;"></progress>
    </div>
    <div class="section" id="match"></div>
    <div class="section" id="details"></div>
    <div class="section" id="sections"></div>
    <div class="section" id="fonts"></div>
    <div class="section" id="notes"></div>
    <div class="section" id="suggestions"></div>
    <div class="section" id="tables-images"></div>
  </div>
  <footer>
    © 2025 مستند - جميع الحقوق محفوظة
  </footer>
  <script>
    // Drag & Drop Logic
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('resumeFile');
    const fileNameDisplay = document.getElementById('fileName');
    const iconWrapper = document.getElementById('iconWrapper');
    const dropText = document.getElementById('dropText');
    const chooseBtn = document.getElementById('chooseBtn');

    dropArea.addEventListener('dragover', (e) => {
      e.preventDefault();
      dropArea.classList.add('dragover');
    });
    dropArea.addEventListener('dragleave', (e) => {
      e.preventDefault();
      dropArea.classList.remove('dragover');
    });
    dropArea.addEventListener('drop', (e) => {
      e.preventDefault();
      dropArea.classList.remove('dragover');
      if (e.dataTransfer.files.length) {
        fileInput.files = e.dataTransfer.files;
        showFileName();
      }
    });
    fileInput.addEventListener('change', showFileName);

    function showFileName() {
      if (fileInput.files.length) {
        fileNameDisplay.textContent = fileInput.files[0].name;
        fileNameDisplay.classList.add('active');
        iconWrapper.classList.add('hide');
        dropText.classList.add('hide');
        chooseBtn.classList.add('hide');
      } else {
        fileNameDisplay.textContent = '';
        fileNameDisplay.classList.remove('active');
        iconWrapper.classList.remove('hide');
        dropText.classList.remove('hide');
        chooseBtn.classList.remove('hide');
      }
    }

    // Form Submit Logic
    document.getElementById('uploadForm').addEventListener('submit', async function (e) {
      e.preventDefault();
      if (!fileInput.files.length) {
        alert("يرجى اختيار ملف السيرة الذاتية");
        return;
      }

      const jobDescription = document.getElementById('jobDescription').value.trim();
      document.getElementById('progress').style.display = "block";
      document.getElementById('progressBar').value = 20;
      document.getElementById('score').innerText = "⏳ جاري تحليل الملف...";

      const formData = new FormData();
      formData.append("resume", fileInput.files[0]);
      formData.append("job_description", jobDescription);

      try {
        const response = await fetch("https://test-ygja.onrender.com/analyze", {
          method: "POST",
          body: formData
        });
        document.getElementById('progressBar').value = 70;
        const data = await response.json();
        document.getElementById('progressBar').value = 100;
        document.getElementById('progress').style.display = "none";
        document.getElementById('score').innerText = `نسبة التوافق: ${data.score}%`;

        let html = "<strong>تحليل التفاصيل:</strong><ul>";
        data.details.found.forEach(k => html += `<li class="found">✅ موجود: ${k}</li>`);
        data.details.missing.forEach(k => html += `<li class="missing">❌ مفقود: ${k}</li>`);
        html += "</ul>";
        document.getElementById('details').innerHTML = html;

        let sectionsHTML = "<strong>تقييم كل قسم:</strong><ul>";
        for (const [section, val] of Object.entries(data.details.sections)) {
          sectionsHTML += `<li>${section}: <b>${val}%</b></li>`;
        }
        sectionsHTML += "</ul>";
        document.getElementById('sections').innerHTML = sectionsHTML;

        if (data.match_score !== undefined && data.match_score !== null) {
          document.getElementById('match').innerText = `📊 نسبة تطابق السيرة مع وصف الوظيفة: ${data.match_score}%`;
        } else {
          document.getElementById('match').innerText = '';
        }

        if (data.fonts?.length) {
          document.getElementById('fonts').innerHTML = `🔤 الخطوط المستخدمة: ${data.fonts.join(", ")}`;
        } else {
          document.getElementById('fonts').innerHTML = '';
        }

        if (data.notes?.length) {
          document.getElementById('notes').innerHTML = '<strong>⚠️ ملاحظات:</strong><ul>' + data.notes.map(n => `<li>🔸 ${n}</li>`).join('') + '</ul>';
        } else {
          document.getElementById('notes').innerHTML = '';
        }

        if (data.suggestions?.length) {
          document.getElementById('suggestions').innerHTML = '<strong>💡 اقتراحات:</strong><ul>' + data.suggestions.map(s => `<li>✅ ${s}</li>`).join('') + '</ul>';
        } else {
          document.getElementById('suggestions').innerHTML = '';
        }

        document.getElementById('tables-images').innerHTML = '';
        if ((data.tables && data.tables > 0) || (data.images && data.images > 0)) {
          let war = `<strong>تحذيرات رسوميات أو جداول:</strong><ul>`;
          if (data.tables > 0) war += `<li>⚠️ تم اكتشاف ${data.tables} جدول</li>`;
          if (data.images > 0) war += `<li>⚠️ تم اكتشاف ${data.images} صورة/عنصر رسومي</li>`;
          war += "</ul>";
          document.getElementById('tables-images').innerHTML = war;
        }
      } catch (err) {
        document.getElementById('progress').style.display = "none";
        document.getElementById('score').innerText = "حدث خطأ أثناء تحليل السيرة الذاتية!";
      }
    });
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="خدمة تحقق من توافق سيرتك الذاتية مع أنظمة ATS وتحسين فرص قبولك في الوظائف">
  <meta name="keywords" content="سيرتك الذاتية, ATS, تحسين السيرة الذاتية, فرص العمل">
  <meta name="author" content="Your Company">
  <meta name="theme-color" content="#227093">
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://yourwebsite.com/">
  <meta property="og:title" content="تحقق من توافق سيرتك الذاتية مع ATS">
  <meta property="og:description" content="خدمة تحقق من توافق سيرتك الذاتية مع أنظمة ATS وتحسين فرص قبولك في الوظائف">
  
  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:url" content="https://yourwebsite.com/">
  <meta property="twitter:title" content="تحقق من توافق سيرتك الذاتية مع ATS">
  <meta property="twitter:description" content="خدمة تحقق من توافق سيرتك الذاتية مع أنظمة ATS وتحسين فرص قبولك في الوظائف">
  
  <title>تحقق من توافق سيرتك الذاتية مع ATS</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
    /* Reset and base styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html, body {
      height: 100%;
      min-height: 100vh;
      scroll-behavior: smooth;
    }

    /* New styles for detailed analysis */
    .analysis-section {
      margin: 20px 0;
      padding: 15px;
      background: #f8f9fa;
      border-radius: 12px;
      border-left: 4px solid #227093;
    }

    .analysis-section h3 {
      color: #227093;
      margin-bottom: 12px;
    }

    .section-score {
      font-size: 24px;
      font-weight: 800;
      color: #227093;
      margin: 10px 0;
    }

    .critical-issue {
      background: #ffebee;
      border-left: 4px solid #ef5350;
      padding: 10px 15px;
      margin: 8px 0;
      border-radius: 0 4px 4px 0;
    }

    .priority-fix {
      background: #fff3e0;
      border-left: 4px solid #ffa726;
      padding: 10px 15px;
      margin: 8px 0;
      border-radius: 0 4px 4px 0;
    }

    .readability-score {
      background: #e8f5e9;
      border-left: 4px solid #4caf50;
      padding: 10px 15px;
      margin: 8px 0;
      border-radius: 0 4px 4px 0;
    }

    .file-info {
      background: #f3f4f6;
      padding: 15px;
      border-radius: 8px;
      margin: 15px 0;
    }

    .file-info-item {
      display: flex;
      justify-content: space-between;
      margin: 8px 0;
      font-size: 14px;
    }

    .progress-bar-container {
      margin: 15px 0;
      padding: 10px;
      background: #f8f9fa;
      border-radius: 8px;
    }

    .progress-bar {
      height: 10px;
      background: #e9ecef;
      border-radius: 5px;
      overflow: hidden;
    }

    .progress-bar-fill {
      height: 100%;
      background: linear-gradient(90deg, #227093, #38ada9);
      border-radius: 5px;
      transition: width 0.3s ease;
    }
    body {
      margin: 0;
      padding: 0;
      min-height: 100vh;
      background-color: #fff;
      background-image:
        radial-gradient(circle, #e5e7ea 1.2px, transparent 1.2px),
        radial-gradient(circle, #e5e7ea 1.2px, transparent 1.2px);
      background-size: 28px 28px;
      background-position: 0 0, 14px 14px;
      display: flex;
      flex-direction: column;
      font-family: 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
      overflow-x: hidden;
    }

    .navbar {
      position: fixed;
      top: 0;
      right: 0;
      left: 0;
      background: #fff;
      padding: 10px 0;
      box-shadow: 0 2px 16px rgba(44, 62, 80, 0.05);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 100;
    }
    .navbar img {
      height: 38px;
      border-radius: 12px;
      background: #fff;
      box-shadow: 0 1px 6px rgba(180, 180, 180, 0.09);
      padding: 4px 12px;
    }

    .container {
      flex: 1 0 auto;
      background: #fff;
      border-radius: 28px;
      box-shadow: 0 10px 40px rgba(52, 152, 219, 0.08);
      padding: 44px 28px 36px 28px;
      width: 98%;
      max-width: 530px;
      margin-top: 60px;
      margin-bottom: 40px;
      animation: slideUp 0.7s cubic-bezier(.77,.01,.29,.99);
      position: relative;
      align-self: center;
    }

    h2 {
      color: #227093;
      font-size: 28px;
      margin-bottom: 32px;
      text-align: center;
      font-weight: 800;
      letter-spacing: 1px;
      word-spacing: 2px;
    }

    .drop-area {
      border: 2px dashed #d3dbe5;
      border-radius: 18px;
      background: #fafbfc;
      min-height: 200px;
      margin: 0 auto 16px auto;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      transition: border-color 0.3s, background 0.3s;
      position: relative;
      overflow: hidden;
    }
    .drop-area.dragover {
      border-color: #38ada9;
      background: #f1fafa;
    }
    .icon-wrapper {
      margin-top: 18px;
      margin-bottom: 8px;
      transition: opacity 0.3s;
    }
    .icon-wrapper.hide {
      opacity: 0;
      pointer-events: none;
      height: 0;
      margin: 0;
    }
    .drop-text {
      color: #bbc4ce;
      font-size: 17px;
      margin-bottom: 8px;
      margin-top: 7px;
      font-weight: 600;
      user-select: none;
      transition: opacity 0.3s;
    }
    .drop-text.hide {
      opacity: 0;
      pointer-events: none;
      height: 0;
      margin: 0;
    }
    .choose-btn {
      background: #fff;
      color: #227093;
      border: 1.5px solid #d3dbe5;
      border-radius: 7px;
      padding: 8px 28px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      margin-bottom: 18px;
      transition: background 0.2s, border 0.2s, opacity 0.3s;
      box-shadow: 0 2px 6px rgba(52,152,219,0.04);
      display: inline-block;
      text-align: center;
    }
    .choose-btn.hide {
      opacity: 0;
      pointer-events: none;
      height: 0;
      margin: 0;
    }
    /* File name display styles */
    .filename {
      margin-top: 0px;
      font-size: 18px;
      color: #fff;
      background: #555;
      border-radius: 30px;
      padding: 32px 48px;
      text-align: center;
      word-break: break-all;
      min-height: 24px;
      margin-bottom: 6px;
      font-family: inherit;
      display: none;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: background 0.2s;
      position: relative;
      overflow: hidden;
    }

    /* Loading spinner */
    .loading-spinner {
      display: none;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 24px;
      height: 24px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid #227093;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: translate(-50%, -50%) rotate(0deg); }
      100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
    .filename.active {
      display: flex;
      animation: fadeIn 0.6s;
    }
    .filename.active:hover {
      background: #353535;
      color: #f3f3f3;
      text-decoration: underline;
    }

    input[type="file"] {
      display: none;
    }

    textarea {
      width: 100%;
      padding: 12px;
      font-size: 15px;
      margin-top: 18px;
      border-radius: 12px;
      border: 1.5px solid #d0e6f6;
      box-sizing: border-box;
      background: #f6fbff;
      resize: vertical;
      min-height: 48px;
      outline: none;
      transition: border 0.25s;
      font-family: 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
    }
    textarea:focus {
      border: 1.5px solid #227093;
      background: #e5f0fb;
    }

    .analyze-btn {
      display: flex;
      justify-content: center;
      align-items: center;
      width: 100%;
      max-width: 230px;
      min-width: 120px;
      margin: 24px auto 0;
      padding: 9px 0 9px 0;
      font-size: 16px;
      font-family: 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(93deg,#1abc9c 0%, #38ada9 60%, #227093 100%);
      color: #fff;
      border: none;
      border-radius: 13px;
      cursor: pointer;
      font-weight: 800;
      box-shadow: 0 3px 18px rgba(44, 62, 80, 0.11);
      letter-spacing: 1px;
      transition: background 0.24s, box-shadow 0.18s, transform 0.13s;
      outline: none;
      position: relative;
    }
    .analyze-btn:hover, .analyze-btn:focus {
      background: linear-gradient(93deg,#227093 0%, #38ada9 50%, #1abc9c 100%);
      box-shadow: 0 4px 28px rgba(44,62,80,0.16), 0 2px 8px rgba(52, 152, 219, 0.07);
      transform: translateY(-2px) scale(1.045);
    }
    .analyze-btn-icon {
      display: inline-block;
      vertical-align: middle;
      margin-right: 3px;
      margin-left: 0;
      line-height: 0;
      position: relative;
      top: 1px;
    }
    .analyze-btn span {
      display: inline-block;
      vertical-align: middle;
      width: 100%;
      text-align: center;
    }

    #score {
      font-size: 23px;
      color: #1abc9c;
      font-weight: 700;
      margin-top: 26px;
      text-align: center;
      letter-spacing: 0.5px;
    }

    #progress {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0 8px 0;
    }
    #progressBar {
      width: 100%;
      height: 13px;
      border-radius: 8px;
      background: #e3f6ff;
      box-shadow: 0 1px 4px rgba(44, 62, 80, 0.04);
      accent-color: #38ada9;
    }

    .section {
      margin: 20px 0 0 0;
      padding: 0 4px;
    }

    .found {
      color: #30b04a;
      font-weight: 600;
      font-size: 15px;
    }
    .missing {
      color: #e74c3c;
      font-weight: 600;
      font-size: 15px;
    }
    ul {
      padding-right: 22px;
      margin: 0;
    }
    li {
      margin-bottom: 7px;
      line-height: 1.7;
      font-size: 15px;
    }

    #fonts, #notes, #suggestions, #tables-images, #sections {
      font-size: 15px;
      background: #f8fafd;
      border-radius: 10px;
      padding: 12px 15px;
      margin-top: 10px;
      box-shadow: 0 1px 8px rgba(44, 62, 80, 0.02);
      border: 1px solid #e4ecf4;
    }

    #fonts strong, #notes strong, #suggestions strong, #tables-images strong, #sections strong {
      color: #227093;
      font-size: 15.5px;
      font-weight: 700;
    }

    #match {
      font-size: 17px;
      color: #227093;
      font-weight: 600;
      letter-spacing: 0.6px;
      margin-top: 18px;
    }

    footer {
      flex-shrink: 0;
      width: 100%;
      text-align: center;
      padding: 16px 0 10px 0;
      font-size: 15px;
      color: #227093;
      background: #fff;
      font-weight: 600;
      animation: fadeIn 1.5s ease-in;
      letter-spacing: 1px;
      margin-top: auto;
      border-top: 1px solid #e3f6ff;
    }

    /* نافذة الرمز السري */
    #passwordModal {
      position: fixed;
      z-index: 9999;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      background: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #passwordModal .box {
      background: #f7f7f7;
      border-radius: 16px;
      box-shadow: 0 6px 32px #0001;
      padding: 36px 32px 26px 32px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 18px;
      min-width: 280px;
    }
    #passwordModal h3 {
      color: #227093;
      margin: 0 0 22px 0;
      font-family: 'Cairo',sans-serif;
      font-size: 22px;
    }
    #secretCodeInput {
      font-size: 18px;
      text-align: center;
      letter-spacing: 6px;
      padding: 13px 18px;
      border-radius: 10px;
      border: 1.5px solid #bbb;
      outline: none;
      width: 160px;
      background: #fff;
    }
    #codeBtn {
      margin-top: 15px;
      background: linear-gradient(90deg,#2ec8d1 0%,#2270b9 100%);
      color: #fff;
      padding: 10px 38px;
      border: none;
      border-radius: 10px;
      font-size: 17px;
      font-weight: 700;
      cursor: pointer;
      box-shadow: 0 2px 6px #22709318;
      transition: background 0.3s;
      font-family: 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
    }
    #codeBtn:hover {
      background: linear-gradient(90deg,#2270b9 0%,#2ec8d1 100%);
    }
    #codeError {
      color: #e74c3c;
      font-size: 15px;
      min-height: 22px;
      text-align: center;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(40px);}
      to { opacity: 1; transform: translateY(0);}
    }

    @media (max-width: 600px) {
      .container { max-width: 99%; padding: 18px 3vw 18px 3vw; }
      h2 { font-size: 21px; }
      .navbar img { height: 28px; }
      .drop-area { min-height: 120px; }
      .icon-wrapper { margin-top: 8px; }
      .choose-btn { font-size: 15px; min-width: 85px; padding: 7px 8px;}
      textarea { font-size: 13px; }
      .filename.active { padding: 18px 12px; font-size: 15px;}
      #passwordModal .box { min-width: 85vw; }
      #secretCodeInput { width: 96vw; max-width: 170px;}
    }
  </style>
</head>
<body>
  <div class="navbar">
    <img src="logo.png" alt="Logo">
  </div>
  <!-- نافذة كلمة السر -->
  <div id="passwordModal">
    <div class="box">
      <h3>دخول برمز سري</h3>
      <input type="password" id="secretCodeInput" maxlength="4" pattern="\d{4}" placeholder="أدخل الرقم السري (٤ أرقام)" autofocus>
      <button id="codeBtn">دخول</button>
      <div id="codeError"></div>
    </div>
  </div>
  <div class="container">
    <h2>تحقق من توافق سيرتك الذاتية مع نظام ATS</h2>
    <form id="uploadForm">
      <div class="drop-area" id="drop-area">
        <div class="icon-wrapper" id="iconWrapper">
          <svg width="56" height="56" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="28" cy="28" r="27" stroke="#ddd" stroke-width="2"/>
            <path d="M28 38V18" stroke="#bbb" stroke-width="2.5" stroke-linecap="round"/>
            <path d="M22 24l6-6 6 6" stroke="#bbb" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
        </div>
        <div class="drop-text" id="dropText">اسحب الملف هنا أو</div>
        <label class="choose-btn" id="chooseBtn">
          اختيار ملف
          <input type="file" id="resumeFile" accept=".pdf,.doc,.docx,.rtf,.txt" hidden>
        </label>
        <div class="filename" id="fileName"></div>
      </div>
      <textarea id="jobDescription" rows="4" placeholder="ألصق وصف الوظيفة هنا للمقارنة... (اختياري)"></textarea>
      <button class="analyze-btn" type="submit">
        <span class="analyze-btn-icon" aria-hidden="true">
          <svg width="18" height="18" viewBox="0 0 22 22" style="vertical-align:middle;margin-left:5px;" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="10" cy="10" r="8" stroke="#fff" stroke-width="2"/>
            <path d="M16.5 16.5L20 20" stroke="#fff" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </span>
        <span>تحليل</span>
      </button>
    </form>
    <div id="results" class="results">
        <div id="score" class="score"></div>
        <div id="progress" class="progress">
          <progress id="progressBar" value="0" max="100"></progress>
        </div>
        
        <!-- File Info -->
        <div id="fileInfo" class="file-info"></div>
        
        <!-- Readability -->
        <div id="readability" class="readability"></div>
        
        <!-- Critical Issues -->
        <div id="criticalIssues" class="critical-issues"></div>
        
        <!-- Priority Fixes -->
        <div id="priorityFixes" class="priority-fixes"></div>
        
        <!-- Detailed Analysis -->
        <div id="detailedAnalysis" class="detailed-analysis"></div>
        
        <!-- Basic Results -->
        <div id="details" class="details"></div>
        <div id="sections" class="sections"></div>
        <div id="match" class="match"></div>
        <div id="fonts" class="fonts"></div>
        <div id="notes" class="notes"></div>
        <div id="suggestions" class="suggestions"></div>
      </div>
    <div class="section" id="tables-images"></div>
  </div>
  <footer>
    © 2025 مستند - جميع الحقوق محفوظة
    <div style="margin-top:10px;font-size:14px;color:#888;line-height:1.7;">
      هذه الأداة لا تضمن مطابقة 100٪ مع أنظمة تتبع المتقدمين (ATS)، وقد تظهر بعض الأخطاء أو النتائج غير الدقيقة. يُرجى مراجعة النتائج والتحقق منها يدوياً.
    </div>
  </footer>
  <script>
    // حماية الصفحة بكود سري (غير باك اند)
    // يمكنك تغيير الرقم السري من هنا:
    const ADMIN_SECRET_CODE = "1234";
    const modal = document.getElementById('passwordModal');
    const input = document.getElementById('secretCodeInput');
    const btn = document.getElementById('codeBtn');
    const error = document.getElementById('codeError');

    function checkCode() {
      if (input.value === ADMIN_SECRET_CODE) {
        modal.style.display = 'none';
        document.body.style.overflow = '';
      } else {
        error.textContent = "رمز غير صحيح!";
        input.value = '';
        input.focus();
      }
    }

    btn.onclick = checkCode;
    input.onkeydown = (e) => { if (e.key === "Enter") checkCode(); };
    window.onload = () => { input.focus(); document.body.style.overflow='hidden'; };

    // Drag & Drop Logic
    const dropArea = document.getElementById('drop-area');
    const fileInput = document.getElementById('resumeFile');
    const fileNameDisplay = document.getElementById('fileName');
    const iconWrapper = document.getElementById('iconWrapper');
      const submitBtn = document.querySelector('.analyze-btn');
      const progressBar = document.getElementById('progressBar');
      const scoreDisplay = document.getElementById('score');
      const progressDiv = document.getElementById('progress');

      // Form Submit Logic with improved error handling
      document.getElementById('uploadForm').addEventListener('submit', async function (e) {
        e.preventDefault();
        
        // Show loading state
        const loadingSpinner = document.createElement('div');
        loadingSpinner.className = 'loading-spinner';
        submitBtn.appendChild(loadingSpinner);
        loadingSpinner.style.display = 'block';
        submitBtn.disabled = true;

        try {
          // Validate file input
          if (!fileInput.files.length) {
            throw new Error('الرجاء اختيار ملف السيرة الذاتية أولاً');
          }

          // Initialize progress
          progressDiv.style.display = 'block';
          progressBar.value = 20;
          scoreDisplay.innerText = '⏳ جاري تحليل الملف...';

          // Create and send form data
          const formData = new FormData();
          formData.append('resume', fileInput.files[0]);
          formData.append('job_description', document.getElementById('jobDescription').value);

          const response = await fetch('https://test-ygja.onrender.com/analyze', {
            method: 'POST',
            body: formData
          });

          if (!response.ok) {
            throw new Error('حدث خطأ أثناء تحليل السيرة الذاتية');
          }

          progressBar.value = 70;
          const result = await response.json();
          progressBar.value = 100;
          scoreDisplay.innerText = result.score + '%';

          // Process result details
          let detailsHTML = '<strong>تحليل التفاصيل:</strong><ul>';
          result.details.found.forEach(k => detailsHTML += `<li class="found">موجود: ${k}</li>`);
          result.details.missing.forEach(k => detailsHTML += `<li class="missing">مفقود: ${k}</li>`);
          detailsHTML += '</ul>';
          document.getElementById('details').innerHTML = detailsHTML;

          let sectionsHTML = '<strong>تقييم كل قسم:</strong><ul>';
          for (const [section, val] of Object.entries(result.details.sections)) {
            sectionsHTML += `<li>${section}: <b>${val}%</b></li>`;
          }
          sectionsHTML += '</ul>';
          document.getElementById('sections').innerHTML = sectionsHTML;

          if (result.match_score !== undefined && result.match_score !== null) {
            document.getElementById('match').innerText = `📊 نسبة تطابق السيرة مع وصف الوظيفة: ${result.match_score}%`;
          } else {
            document.getElementById('match').innerText = '';
          }

          if (result.fonts?.length) {
            document.getElementById('fonts').innerHTML = `🔤 الخطوط المستخدمة: ${result.fonts.join(", ")}`;
          } else {
            document.getElementById('fonts').innerHTML = '';
          }

          if (result.notes?.length) {
            document.getElementById('notes').innerHTML = '<strong>⚠️ ملاحظات:</strong><ul>' + 
              result.notes.map(n => `<li>🔸 ${n}</li>`).join('') + '</ul>';
          } else {
            document.getElementById('notes').innerHTML = '';
          }

          if (result.improvements?.critical_issues?.length) {
            document.getElementById('criticalIssues').innerHTML = '<strong>⚠️ المشاكل الحرجة:</strong><ul>' + 
              result.improvements.critical_issues.map(i => `<li class="critical-issue">${i}</li>`).join('') + '</ul>';
          } else {
            document.getElementById('criticalIssues').innerHTML = '';
          }

          if (result.improvements?.priority_fixes?.length) {
            document.getElementById('priorityFixes').innerHTML = '<strong>⚡ الأولويات:</strong><ul>' + 
              result.improvements.priority_fixes.map(f => `<li class="priority-fix">${f}</li>`).join('') + '</ul>';
          } else {
            document.getElementById('priorityFixes').innerHTML = '';
          }

          if (result.file_info) {
            const fileInfoHTML = `
              <div class="file-info-item">
                <span>اسم الملف:</span>
                <span>${result.file_info.name}</span>
              </div>
              <div class="file-info-item">
                <span>حجم الملف:</span>
                <span>${(result.file_info.size / 1024).toFixed(1)} KB</span>
              </div>
              <div class="file-info-item">
                <span>عدد الكلمات:</span>
                <span>${result.file_info.word_count}</span>
              </div>
            `;
            document.getElementById('fileInfo').innerHTML = fileInfoHTML;
          }

          if (result.readability_score !== undefined) {
            const readabilityHTML = `
              <div class="readability-score">
                <strong>قابلية القراءة:</strong>
                <span>${result.readability_score}%</span>
              </div>
            `;
            document.getElementById('readability').innerHTML = readabilityHTML;
          }

          if (result.detailed_analysis) {
            const detailedHTML = `
              <div class="analysis-section">
                <h3>تحليل مفصل</h3>
                ${Object.entries(result.detailed_analysis)
                  .map(([section, data]) => `
                    <div class="section-score">
                      <strong>${section}:</strong>
                      <span>${data.score}%</span>
                    </div>
                    <div class="progress-bar-container">
                      <div class="progress-bar">
                        <div class="progress-bar-fill" style="width: ${data.score}%"></div>
                      </div>
                    </div>
                    <div>
                      <strong>المطابقات:</strong> ${data.matches}/${data.total_keywords}
                      <br>
                      <strong>جودة السياق:</strong> ${data.context_quality}%
                    </div>
                  `)
                  .join('')}
              </div>
            `;
            document.getElementById('detailedAnalysis').innerHTML = detailedHTML;
          }

          if (result.improvements?.suggestions?.length) {
            document.getElementById('suggestions').innerHTML = '<strong>💡 اقتراحات:</strong><ul>' + 
              result.improvements.suggestions.map(s => `<li>✅ ${s}</li>`).join('') + '</ul>';
          } else {
            document.getElementById('suggestions').innerHTML = '';
          }
        } catch (error) {
          progressDiv.style.display = 'none';
          scoreDisplay.innerText = 'حدث خطأ';
          console.error('Error:', error);
        } finally {
          // Clean up loading state
          const spinner = submitBtn.querySelector('.loading-spinner');
          if (spinner) {
            spinner.remove();
          }
          submitBtn.disabled = false;
          progressDiv.style.display = 'none';
        }
      });

      // Drag & Drop Logic
      dropArea.addEventListener('dragover', (e) => {
        e.preventDefault();
        dropArea.classList.add('dragover');
      });

      dropArea.addEventListener('dragleave', () => {
        dropArea.classList.remove('dragover');
      });

      dropArea.addEventListener('drop', (e) => {
        e.preventDefault();
        dropArea.classList.remove('dragover');
        const files = e.dataTransfer.files;
        if (files.length) {
          fileInput.files = files;
          showFileName();
        }
      });

      fileInput.addEventListener('change', showFileName);

      function showFileName() {
        const file = fileInput.files[0];
        if (file) {
          fileNameDisplay.textContent = file.name;
          fileNameDisplay.classList.add('active');
        } else {
          fileNameDisplay.classList.remove('active');
        }
      }

      // السماح باختيار ملف جديد عند الضغط على اسم الملف
      fileNameDisplay.addEventListener('click', () => {
        fileInput.value = '';
        fileInput.click();
      });

      // تحسينات إضافية
      // تأكيد قبل مسح كل النتائج
      document.getElementById('clearResults').addEventListener('click', (e) => {
        if (confirm('هل أنت متأكد من مسح كل النتائج؟')) {
          // Clear basic elements
          document.getElementById('details').innerHTML = '';
          document.getElementById('sections').innerHTML = '';
          document.getElementById('match').innerText = '';
          document.getElementById('fonts').innerHTML = '';
          document.getElementById('notes').innerHTML = '';
          document.getElementById('suggestions').innerHTML = '';
          
          // Clear new elements
          document.getElementById('fileInfo').innerHTML = '';
          document.getElementById('readability').innerHTML = '';
          document.getElementById('criticalIssues').innerHTML = '';
          document.getElementById('priorityFixes').innerHTML = '';
          document.getElementById('detailedAnalysis').innerHTML = '';
          
          // Reset score and progress
          scoreDisplay.innerText = '';
          progressDiv.style.display = 'none';
          progressBar.value = 0;
          
          // Reset file input
          fileInput.value = '';
          fileNameDisplay.textContent = 'اختر ملف السيرة الذاتية';
        }
      });
    });
  </script>
</body>
</html>
